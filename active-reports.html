<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù†Ø´Ø·Ø© - LifeBand</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .reports-container { padding: 40px 20px; }
      /* ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø±ØªØ¨Ø© */
.report-card { 
    background: var(--glass); 
    padding: 25px; 
    border-radius: 18px; 
    margin-bottom: 20px; 
    border-right: 6px solid var(--primary); 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    transition: 0.3s ease;
    box-shadow: var(--card-shadow);
}

.report-card:hover { transform: translateY(-3px); }

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØµÙˆØµ */
.report-info h3 { color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.report-info p { margin: 5px 0; font-size: 14px; line-height: 1.6; }
.report-meta { display: flex; gap: 20px; opacity: 0.8; font-size: 12px; margin-bottom: 10px; }

/* Ø§Ù„Ø£ÙˆØ³Ù…Ø© (Tags) */
.status-tag { 
    padding: 4px 12px; 
    border-radius: 50px; 
    font-size: 12px; 
    font-weight: bold; 
}
.status-pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; border: 1px solid #f59e0b; }
.status-done { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid #10b981; }

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.report-actions { display: flex; gap: 10px; }        .respond-btn { background: #10b981 !important; width: auto !important; padding: 10px 25px !important; }
        .lang-toggle { background: var(--glass); border: 1px solid var(--glass-border); color: var(--text-main); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; transition: 0.3s; }
    </style>
</head>
<body class="page-fade">
    <div class="bg-animation"></div>
    <div class="container">
        <header class="navbar">
            <a href="index.html" class="nav-brand">LifeBand</a>
            <div id="auth-zone">
                <a href="active-reports.html" class="nav-item" data-i18n="nav_active">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯Ø©</a>
                <a href="history.html" class="nav-item" data-i18n="nav_history">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</a>
                <a href="rewards.html" class="nav-item" data-i18n="nav_rewards">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</a>
            </div>
            <div class="nav-links" style="display: flex; gap: 10px; align-items: center;">
                <button class="lang-toggle" id="langBtn">EN</button>
                <button class="theme-toggle" id="themeBtn">ğŸŒ™</button>
            </div>
        </header>

        <main class="reports-container">
            <h2 data-i18n="reports_title">âš ï¸ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            <div id="reportsList" style="margin-top: 25px;"></div>
        </main>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…ÙˆØ­Ø¯ ---
        const t = {
            ar: { nav_active: "Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯Ø©", nav_history: "Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª", nav_rewards: "Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª", reports_title: "âš ï¸ Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©", btn_respond: "Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©", empty: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ù„Ø§ØºØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹", lang_label: "EN" },
            en: { nav_active: "Active Reports", nav_history: "Case History", nav_rewards: "Rewards", reports_title: "âš ï¸ Active Reports", btn_respond: "Respond", empty: "No active reports", lang_label: "AR" }
        };

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => { el.innerText = t[lang][el.getAttribute('data-i18n')]; });
            document.getElementById('langBtn').innerText = t[lang].lang_label;
            localStorage.setItem('preferred_lang', lang);
        }

        document.getElementById('langBtn').onclick = () => {
            const current = localStorage.getItem('preferred_lang') || 'ar';
            setLanguage(current === 'ar' ? 'en' : 'ar');
            window.location.reload(); 
        };

        const themeBtn = document.getElementById('themeBtn');
        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme === 'dark' ? 'dark' : '');
            themeBtn.innerText = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        applyTheme(localStorage.getItem('theme') || 'light');
        themeBtn.onclick = () => {
            const nt = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', nt);
            applyTheme(nt);
        };

        setLanguage(localStorage.getItem('preferred_lang') || 'ar');

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        const reportsList = document.getElementById('reportsList');
        const currentLang = localStorage.getItem('preferred_lang') || 'ar';

        onValue(ref(db, 'reports'), (snapshot) => {
            reportsList.innerHTML = "";
            snapshot.forEach((child) => {
                const data = child.val();
                if (data.status === "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±") {
                    const card = document.createElement('div');
                    card.className = 'report-card';
                    card.innerHTML = `
                        <div class="report-info">
                            <h3>${data.patientName || 'Unknown'}</h3>
                            <p>${data.diagnosis}</p>
                        </div>
                        <button class="main-btn respond-btn" onclick="handleResponse('${child.key}')">${t[currentLang].btn_respond}</button>
                    `;
                    reportsList.appendChild(card);
                }
            });
            if (!reportsList.innerHTML) reportsList.innerHTML = `<p>${t[currentLang].empty}</p>`;
        });

        window.handleResponse = async (id) => {
            const user = auth.currentUser;
            if (user) await update(ref(db, `reports/${id}`), { status: "ØªÙ…Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©", rescuerId: user.uid });
        };
    </script>
</body>
</html>