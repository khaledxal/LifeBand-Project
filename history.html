<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª - LifeBand</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="page-fade">
    <div class="bg-animation"></div>
    <div class="container">
        <header class="navbar">
            <a href="index.html" class="nav-brand">LifeBand</a>
            <div id="auth-zone">
                <a href="active-reports.html" class="nav-item" data-i18n="nav_active">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯Ø©</a>
                <a href="history.html" class="nav-item" data-i18n="nav_history">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</a>
                <a href="rewards.html" class="nav-item" data-i18n="nav_rewards">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</a>
            </div>
            <div class="nav-links" style="display: flex; gap: 10px; align-items: center;">
                <button class="lang-toggle" id="langBtn">EN</button>
                <button class="theme-toggle" id="themeBtn">ğŸŒ™</button>
            </div>
        </header>

        <main style="padding: 40px 20px;">
            <h2 data-i18n="history_title">ğŸ“‹ Ø³Ø¬Ù„Ùƒ Ø§Ù„Ø¨Ø·ÙˆÙ„ÙŠ</h2>
            <div id="historyList" style="margin-top:25px;"></div>
        </main>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Ù†ÙØ³ Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø«ÙŠÙ… Ø§Ù„Ù…ÙˆØ¶Ø­ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙŠÙƒØ±Ø± Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        const t = {
            ar: { nav_active: "Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯Ø©", nav_history: "Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª", nav_rewards: "Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª", history_title: "ğŸ“‹ Ø³Ø¬Ù„Ùƒ Ø§Ù„Ø¨Ø·ÙˆÙ„ÙŠ", lang_label: "EN" },
            en: { nav_active: "Active Reports", nav_history: "Case History", nav_rewards: "Rewards", history_title: "ğŸ“‹ Your Heroic History", lang_label: "AR" }
        };

        // (ÙŠØªÙ… ÙˆØ¶Ø¹ Ø¯ÙˆØ§Ù„ setLanguage Ùˆ applyTheme Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©)
        // ... Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ù„Ø«ÙŠÙ… ÙˆØ§Ù„Ù„ØºØ© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ...

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onValue(ref(db, 'reports'), (snapshot) => {
                    const list = document.getElementById('historyList');
                    list.innerHTML = "";
                    snapshot.forEach((child) => {
                        const data = child.val();
                        if (data.rescuerId === user.uid) {
                            const item = document.createElement('div');
                            item.className = 'info-card';
                            item.style.marginBottom = "15px";
                            item.innerHTML = `<h4>${data.patientName}</h4><p>${data.diagnosis}</p><span style="color:#10b981">âœ… Done</span>`;
                            list.appendChild(item);
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>