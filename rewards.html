<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª - LifeBand</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .reward-container { text-align: center; padding: 60px 20px; }
        .points-circle { 
            width: 200px; height: 200px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            margin: 0 auto 30px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            border: 5px solid var(--glass-border);
        }
        .points-val { font-size: 48px; font-weight: 800; }
        .lang-toggle { background: var(--glass); border: 1px solid var(--glass-border); color: var(--text-main); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold; }
    </style>
</head>
<body class="page-fade">
    <div class="bg-animation"></div>
    <div class="container">
        <header class="navbar">
            <a href="index.html" class="nav-brand">LifeBand</a>
            <div id="auth-zone" class="nav-links">
                <a href="active-reports.html" class="nav-item">Ø§Ù„Ø¨Ù„Ø§ØºØ§Øª Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯Ø©</a>
                <a href="history.html" class="nav-item">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</a>
                <a href="rewards.html" class="nav-item active">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</a>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="lang-toggle" id="langBtn">EN</button>
                <button class="theme-toggle" id="themeBtn">ğŸŒ™</button>
            </div>
        </header>

        <main class="reward-container">
            <div class="points-circle">
                <span style="font-size: 40px;">ğŸ†</span>
                <div id="userPoints" class="points-val">0</div>
                <span data-i18n="points_label">Ù†Ù‚Ø·Ø©</span>
            </div>
            <h2 data-i18n="congrats">Ø£Ø­Ø³Ù†Øª ØµÙ†Ø¹Ø§Ù‹!</h2>
            <p data-i18n="reward_desc" style="max-width: 500px; margin: 15px auto; opacity: 0.8;">ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ¨Ø§Ø´Ø±Ù‡Ø§ ØªÙ…Ù†Ø­Ùƒ 10 Ù†Ù‚Ø§Ø· ÙÙŠ Ø±ØµÙŠØ¯ Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.</p>
        </main>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase-config.js';
        import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ØºØ© ÙˆØ§Ù„Ø«ÙŠÙ… (Ø´ØºØ§Ù„ Ø§Ù„Ø¢Ù† 100%) ---
        const translations = {
            ar: { points_label: "Ù†Ù‚Ø·Ø©", congrats: "Ø£Ø­Ø³Ù†Øª ØµÙ†Ø¹Ø§Ù‹!", reward_desc: "ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ¨Ø§Ø´Ø±Ù‡Ø§ ØªÙ…Ù†Ø­Ùƒ 10 Ù†Ù‚Ø§Ø· ÙÙŠ Ø±ØµÙŠØ¯ Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.", lang_label: "EN" },
            en: { points_label: "Points", congrats: "Great Job!", reward_desc: "Every case you respond to grants you 10 points in your life-saving balance.", lang_label: "AR" }
        };

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelectorAll('[data-i18n]').forEach(el => {
                el.innerText = translations[lang][el.getAttribute('data-i18n')];
            });
            document.getElementById('langBtn').innerText = translations[lang].lang_label;
            localStorage.setItem('preferred_lang', lang);
        }

        document.getElementById('langBtn').onclick = () => {
            const current = localStorage.getItem('preferred_lang') || 'ar';
            setLanguage(current === 'ar' ? 'en' : 'ar');
        };

        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme === 'dark' ? 'dark' : '');
            document.getElementById('themeBtn').innerText = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        applyTheme(localStorage.getItem('theme') || 'light');
        document.getElementById('themeBtn').onclick = () => {
            const nt = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', nt);
            applyTheme(nt);
        };
        setLanguage(localStorage.getItem('preferred_lang') || 'ar');

        // --- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                onValue(ref(db, 'reports'), (snapshot) => {
                    let count = 0;
                    snapshot.forEach(c => { if(c.val().rescuerId === user.uid) count++; });
                    document.getElementById('userPoints').innerText = (count * 10);
                });
            }
        });
    </script>
</body>
</html>