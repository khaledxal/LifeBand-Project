<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª - LifeBand</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .reward-container { text-align: center; padding: 60px 20px; }
        .points-circle { 
            width: 200px; height: 200px; border-radius: 50%; 
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            margin: 0 auto 30px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            border: 5px solid var(--glass-border);
        }
        .points-val { font-size: 48px; font-weight: 800; }
    </style>
</head>
<body class="page-fade">
    <div class="bg-animation"></div>

    <div class="container" id="main-layout">
        
        <main class="reward-container">
            <div class="points-circle">
                <span style="font-size: 40px;">ğŸ†</span>
                <div id="userPoints" class="points-val">0</div>
                <span data-i18n="points_label">Ù†Ù‚Ø·Ø©</span>
            </div>
            <h2 data-i18n="congrats">Ø£Ø­Ø³Ù†Øª ØµÙ†Ø¹Ø§Ù‹!</h2>
            <p data-i18n="reward_desc" style="max-width: 500px; margin: 15px auto; opacity: 0.8;">ÙƒÙ„ Ø­Ø§Ù„Ø© ØªØ¨Ø§Ø´Ø±Ù‡Ø§ ØªÙ…Ù†Ø­Ùƒ 10 Ù†Ù‚Ø§Ø· ÙÙŠ Ø±ØµÙŠØ¯ Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ.</p>
        </main>

    </div>

    <script type="module">
        import { injectLayout } from './js/layout.js';
        import { auth, db } from './js/firebase-config.js';
        import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯ (Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ±)
        injectLayout();

        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ Ø¨Ø§Ø´Ø±Ù‡Ø§ Ø§Ù„Ù…Ø³Ø¹Ù
        onAuthStateChanged(auth, (user) => {
            if (user) {
                onValue(ref(db, 'reports'), (snapshot) => {
                    let count = 0;
                    snapshot.forEach(c => { 
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†Ù‚Ø° ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                        if(c.val().rescuerId === user.uid) count++; 
                    });
                    const pointsDisplay = document.getElementById('userPoints');
                    if(pointsDisplay) pointsDisplay.innerText = (count * 10);
                });
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ØŒ ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                window.location.href = "login.html";
            }
        });
    </script>
</body>
</html>